# 2. 불변 객체# 💡 불변 객체 개요- 자바에서 가장 많이 사용되는 `String` 클래스가 바로 불변객체이다. (Integer, LocalDate 등 수많은 클래스가 불변)- 모든 클래스를 불변으로 만드는 건 아니다. (예를 들어, 회원의 여러 속성은 자주 변경 되어야 한다)- **불변으로 설계 하는 이유**는 `캐시 안전성`, `멀티 쓰레드 안전성`, `엔티티의 값 타입`## 공유 참조와 사이드 이펙트```java//참조형 변수는 하나의 인스턴스를 공유할 수 있다. Address a = new Address("서울"); Address b = a;System.out.println("a = " + a);System.out.println("b = " + b);b.setValue("부산");System.out.println("부산 -> b");System.out.println("a = " + a); // 사이드 이펙트 발생System.out.println("b = " + b);```## 사이드 이펙트가 발생하는 이유- b의 값을 바꾸면서, a의 값까지 발생하는 문제가 발생했다- 객체를 공유하고, 공유된 객체의 값을 변경하기 때문에 발생한다- `Address` 객체의 값을 변경하지 못 하게 설계한다면 사이드 이펙트가 발생하지 않는다<br/><br/><br/># 💡 불변 객체 도입> `불변 객체(Immutable Object)`: **객체의 상태(값, 필드, 멤버변수)가 변하지 않는 객체**- 내부 값이 변경되기 안되기 때문에 `final` 로 선언- 값을 변경할 수 있는 `setValue()`를 제거- **`final` 이 핵심이 아니라, 절대 값을 변경 못하게 만드는게 `불변 객체`**  - **`final` 을 선언해두면, 좀 더 의도를 확실하게 나타낼 수 있다.**```javapublic class ImmutableAddress {    private final String value;    public ImmutableAddress(String value) {        this.value = value;    }    public String getValue() {        return value;    }    @Override    public String toString() {        return "Address{" +            "value='" + value + '\'' +            '}';    }}``````javaImmutableAddress a = new ImmutableAddress("서울");ImmutableAddress b = a; // 이걸 막을 방법은 없다// b.setValue("부산"); // 컴파일 오류가 발생하여, 이를 사용하는 개발자는 불변객체임을 알게 됨b = new ImmutableAddress("부산"); // 새로운 객체로 생성한다```<img width="500" alt="스크린샷 2024-07-23 오전 1 13 44" src="https://github.com/user-attachments/assets/b8239463-251e-49b5-8e21-3d2e54d636f0">## ⚡️ 정리> **불변이라는 단순한 제약을 사용해서 사이드 이펙트라는 큰 문제를 막을 수 있다.**- **객체의 공유 참조는 막을 수 없다.** 그래서 객체의 값을 변경하면 다른 곳에서 참조하는 변수의 값도 함께 변경되는 사이드 이펙트가 발생한다. 사이드 이펙트가 발생하면 안되는 상황이라면 불변 객체를 만들어서 사용하면 된다. 불변 객체는 값을 변경할 수 없기 때문에 사이드 이펙트가 원천 차단된다.- 불변 객체는 값을 변경할 수 없다. 따라서 불변 객체의 값을 변경하고 싶다면 변경하고 싶은 값으로 새로운 불변 객체를 생성해야 한다. 이렇게 하면 기존 변수들이 참조하는 값에는 영향을 주지 않는다.<br/><br/><br/># 💡 불변 객체 값 변경이 필요한 경우- 예를 들어, 기존 값에 새로운 값을 더하는 add() 같은 메소드가 있다면? - 불변 객체는 값을 변경하면 안된다! 그러면 이미 불변 객체가 아니다!```javapublic class ImmutableObj {    private final int value;    public ImmutableObj(int value) {        this.value = value;    }    public ImmutableObj add(int addValue) {        int result = value + addValue;        return new ImmutableObj(result); // 새로 생성한 ImmutableObj 를 return 한다      }    public int getValue() {        return value;    }}```## ⚡️ 정리> **불변 객체는 기존 값은 변경하지 않고 대신에 계산 결과를 바탕으로 새로운 객체를 만들어서 반환한다.**- 이렇게 하면 불변도 유지하면서 새로운 결과도 만들 수 있다.- 불변 객체에서 변경과 관련된 메서드들은 보통 객체를 새로 만들어서 반환하기 때문에 ***꼭! 반환 값을 받아야 한다.***### 🔋 불변객체에서의 with 관례> 불변 객체의 메서드가 `with` 로 이름 지어진 경우, **그 메서드가 지정된 수정사항을 포함하는 객체의 새 인스턴스를 반환한다**는 사실을 뜻한다.- `withValue` 를 사용할 경우, 새로운 객체를 반환한다고 생각하면 된다.```javapublic ImmutableMyDate withYear(int newYear){  return new ImmutableMyDate(newYear, month, day);}``````java ImmutableMyDate date1 = new ImmutableMyDate(2024,1,1); date1 = date1.withYear(2025);```