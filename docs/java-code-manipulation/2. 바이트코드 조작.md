# 2. ë°”ì´íŠ¸ ì½”ë“œ ì¡°ì‘<br/>## ëª©ì°¨- JAVA ë°”ì´íŠ¸ ì½”ë“œ ì¡°ì‘ì˜ ì—¬ëŸ¬ê°€ì§€ ì“°ì„ìƒˆ- JAVA bytecode(.class íŒŒì¼)ì„ ì¡°ì‘í•˜ì—¬ í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ ì¸¡ì •í•˜ê¸°- ë°”ì´íŠ¸ ì½”ë“œ ì¡°ì‘í•˜ëŠ” ë°©ë²•(bytebuddy, javaagent)- Spring ì€ asm ì„ ì´ìš©í•˜ì—¬ ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº”ì„ í•œë‹¤<br/><br/><br/># ğŸ’¡ JAVA ë°”ì´íŠ¸ ì½”ë“œ ì¡°ì‘ì˜ ì—¬ëŸ¬ê°€ì§€ ì“°ì„ìƒˆ## âš¡ï¸ í”„ë¡œê·¸ë¨ ë¶„ì„- ì½”ë“œì—ì„œ ë²„ê·¸ë¥¼ ì°¾ëŠ” íˆ´- ì½”ë“œ ë³µì¡ë„ ê³„ì‚° íˆ´## âš¡ï¸ í´ë˜ìŠ¤íŒŒì¼ ìƒì„±- í”„ë¡ì‹œ    - Spring AOP, Hibernate Lazy Loading, Mock- íŠ¹ì • API í˜¸ì¶œ ì ‘ê·¼ ì œí•œ- ìŠ¤ì¹¼ë¼ì™€ ê°™ì€ ì–¸ì–´ì˜ ì»´íŒŒì¼ëŸ¬## âš¡ï¸ ìë°” ì†ŒìŠ¤ì½”ë“œë¥¼ ê±´ë“œë¦¬ì§€ ì•Šê³  í•  ìˆ˜ ìˆëŠ” ì´ê²ƒ ì €ê²ƒë“¤ (transparent í•˜ê²Œ ë¬´ì—‡ì¸ê°€ë¥¼ í•  ìˆ˜ ìˆëŠ” ê³³)- í”„ë¡œíŒŒì¼ëŸ¬ (spring ì—ì„œ ë‚˜ì˜¨ newrelic)- ìµœì í™” - ë¡œê¹… ë“±## âš¡ï¸ ìŠ¤í”„ë§ì˜ ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº”- ASMì„ ì‚¬ìš©í•œë‹¤.- ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº”ìœ¼ë¡œ ë¹ˆìœ¼ë¡œ ë“±ë¡í•  ëŒ€ìƒ í´ë˜ìŠ¤ë¥¼ ì°¾ëŠ”ë° ìƒìš”í•¨- ClassPathScanningCandidateComponentProvider  -> SimpleMetadataReader ë¥¼ ì‚¬ìš©í•´ì„œ ë©”íƒ€ë°ì´í„°ë¥¼ ì½ì–´ì˜¨ë‹¤.- ìŠ¤í”„ë§ì—ì„œ ë²„ì „ë¬¸ì œ ë•Œë¬¸ì— íŒ¨í‚¤ì§•ì„ í–ˆì„ë¿ ASMì„ ì‚¬ìš©í•œë‹¤.<br/><br/><br/># ğŸ’¡JAVA bytecode(.class íŒŒì¼)ì„ ì¡°ì‘í•˜ì—¬ í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ ì¸¡ì •í•˜ê¸°> ë°”ì´íŠ¸ ì½”ë“œë¥¼ ì¡°ì‘í•˜ëŠ” ëŒ€í‘œì ì¸ ì˜ˆì‹œì¸ ì½”ë“œ ì»¤ë²„ë¦¬ì§€ íˆ´ì„ ì‚´í´ë³´ì.## âš¡ï¸ ì½”ë“œ ì»¤ë²„ë¦¬ì§€ë€ ?- ì½”ë“œ ì»¤ë²„ë¦¬ì§€ëŠ” í…ŒìŠ¤íŠ¸ì½”ë“œê°€ ë‚´ ì†ŒìŠ¤ì½”ë“œì˜ ì–´ëŠì •ë„ë¥¼ í…ŒìŠ¤íŠ¸í•˜ëŠ”ì§€ í™•ì¸í•˜ëŠ” íˆ´ì´ë‹¤.- ìµœê·¼ì— ê°€ì¥ ë§ì´ ì‚¬ìš©í•˜ëŠ” `JaCoCo` ë¼ëŠ” íˆ´ì„ ì‚¬ìš©í•´ë³´ì.## âš¡ï¸ JaCoCo í”ŒëŸ¬ê·¸ì¸ ì¶”ê°€í•˜ê¸° (using gradle)- [jacoco í”ŒëŸ¬ê·¸ì¸ ì¶”ê°€í•˜ê¸°](https://docs.gradle.org/current/userguide/jacoco_plugin.html)ìœ„ì˜ ë§í¬ì— ì°¸ê³ ëœ ë¬¸ì„œì— ë”°ë¼ ì°¨ë¡€ëŒ€ë¡œ JaCoCo í”ŒëŸ¬ê·¸ì¸ì„ ì„¤ì¹˜í•œ ë’¤,   gradle java project ì—ì„œ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ë©´,  `build/customJacocoReportDir/test/html/default/index.html` ì— í…ŒìŠ¤íŠ¸ ê²°ê³¼ ë¦¬í¬íŠ¸ê°€ ìƒì„±ëœë‹¤.```groovyplugins {    id 'jacoco'}test {    finalizedBy jacocoTestReport // report is always generated after tests run}jacocoTestReport {    dependsOn test // tests are required to run before generating the report}jacoco {    toolVersion = "0.8.8"    reportsDirectory = layout.buildDirectory.dir('customJacocoReportDir')}```<br/><br/>## âš¡ï¸ í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‘ì„±í•˜ê¸°- ê·¸ë£¹ì—ëŠ” ìµœëŒ€ ì°¸ê°€ìì™€ í˜„ì¬ ì‹ ì²­ì ì •ë³´ë¥¼ ê°€ì§€ê³  ìˆìœ¼ë©°, isFull() ë©”ì†Œë“œë¥¼ í†µí•´ ì°¸ê°€ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆëŠ”ì§€ í™•ì¸í•  ìˆ˜ ìˆë‹¤.```javapublic class Group {    /* ìµœëŒ€ ì°¸ê°€ì */    int maxNumberOfAttendees;    /* í˜„ì¬ ì‹ ì²­ì */    int numberOfEnrollment;    public boolean isFull () {        if (maxNumberOfAttendees == 0) {            return false;        }        if (numberOfEnrollment < maxNumberOfAttendees) {            return false;        }        return true;    }}````GroupTest`- groupì„ ìƒì„±í•˜ê³ , ìµœëŒ€ ì°¸ê°€ìë¥¼ 100ëª…ìœ¼ë¡œ ì„¤ì •í•œë‹¤.- í˜„ì¬ ì°¸ê°€ììˆ˜ë¥¼ 100ëª…ìœ¼ë¡œ ì§€ì •í•œë’¤, isFull() ë©”ì†Œë“œë¥¼ í†µí•´ í˜„ì¬ ì°¸ê°€ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆëŠ”ì§€ í™•ì¸í•´ë³¸ë‹¤.- ê¸°ëŒ€ê°’ì€ True ì´ë‹¤.```javapublic class GroupTest {    @Test    public void isFull () {        Group group = new Group();        group.maxNumberOfAttendees = 100;        group.numberOfEnrollment = 100;        assertTrue(group.isFull());    }}```<br/><br/>## âš¡ï¸ JaCoCo ì‹¤í–‰í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ë©´, JaCoCo í”ŒëŸ¬ê·¸ì¸ë„ í•¨ê»˜ ì‹¤í–‰ëœë‹¤.`build/customJaCoCoReportDir/test/html/default/index.html`  (build.gradle ì— ì§€ì •í•œ directory) ì— í…ŒìŠ¤íŠ¸ ê²°ê³¼ ë¦¬í¬íŠ¸ê°€ ìƒì„±ëœë‹¤.## âš¡ï¸ ì‹¤í–‰ ê²°ê³¼<img width="554" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-07-09 á„‹á…©á„’á…® 2 42 06" src="https://github.com/LeeHyungGeol/Algorithm_BaekJoon/assets/56071088/49a930b3-f316-45c0-82b3-e9b0090d09db"><img width="831" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-07-09 á„‹á…©á„’á…® 3 05 37" src="https://github.com/LeeHyungGeol/Algorithm_BaekJoon/assets/56071088/db9d59c1-2722-4a47-93c1-db149a2da77c">ì‹¤í–‰ ê²°ê³¼ë¥¼ ë³´ë©´ ì†ŒìŠ¤ ì½”ë“œë ˆë²¨ì—ì„œ ë…¸ë€ìƒ‰, ë¶‰ì€ìƒ‰, ì´ˆë¡ìƒ‰ ë¼ì¸ì´ ì¡´ì¬í•œë‹¤.- ë…¸ë€ìƒ‰ ë¼ì¸ì€ í•´ë‹¹ ì¡°ê±´ì‹ì˜ í•œê°€ì§€ ê²½ìš°ë§Œ í…ŒìŠ¤íŠ¸í–ˆë‹¤ëŠ” ê²ƒì„ ì˜ë¯¸í•œë‹¤.    - ì¦‰ true, falseì¤‘ í•˜ë‚˜ì˜ ì¼€ì´ìŠ¤ë§Œ í…ŒìŠ¤íŠ¸ëœê²ƒ- ë¶‰ì€ìƒ‰ ë¼ì¸ì€ í•´ë‹¹ ë¼ì¸ì´ ì‹¤í–‰ë˜ëŠ” í…ŒìŠ¤íŠ¸ê°€ ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ì˜ë¯¸ì´ë‹¤.- ì´ˆë¡ìƒ‰ ë¼ì¸ì€ í•´ë‹¹ ë¼ì¸ì´ í†µê³¼ë˜ì—ˆë‹¤ëŠ” ì˜ë¯¸ì´ë‹¤.## âš¡ï¸ ì‘ë™ì›ë¦¬- ë°”ì´íŠ¸ ì½”ë“œë¥¼ ì½ì–´ì„œ ë°”ì´íŠ¸ ì½”ë“œì—ì„œ ì½”ë“œ ì»¤ë²„ë¦¬ì§€ë¥¼ ì±™ê²¨ì•¼ ë˜ëŠ” ë¶€ë¶„ì˜ ê°œìˆ˜ë¥¼ ë¯¸ë¦¬ ë‹¤ ì„¸ì–´ë†“ëŠ”ë‹¤.   - ê·¸ë¦¬ê³  ì½”ë“œë¥¼ ëŒë¦¬ë©´ì„œ ê·¸ ì¤‘ì— ëª‡ê°œë¥¼ ì§€ë‚˜ê°”ëŠ”ì§€ë¥¼ ì„¸ì–´ì„œ ì½”ë“œ ì»¤ë²„ë¦¬ì§€ë¥¼ ì¸¡ì •í•œë‹¤.<br/><br/><br/># ğŸ’¡ ë°”ì´íŠ¸ ì½”ë“œ ì¡°ì‘í•˜ëŠ” ë°©ë²•(bytebuddy, javaagent)## âš¡ï¸ ë°”ì´íŠ¸ ì½”ë“œ ì¡°ì‘ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¹„êµ`ASM`: https://asm.ow2.io/- ë§¤ìš° ì–´ë µë‹¤ê³  í•œë‹¤. ëŸ¬ë‹ ì»¤ë¸Œê°€ ë†’ê³ , ìë°”ì˜ ë°”ì´íŠ¸ì½”ë“œ êµ¬ì¡°ë¥¼ ì–´ëŠì •ë„ ì•Œê³  ìˆê³  ë””ìì¸ íŒ¨í„´ì— ìµìˆ™í•´ë„ ì´í•´í•˜ê³  ì‚¬ìš©í•˜ê¸°ê±° ì–´ë µë‹¤ê³  í•œë‹¤.- ìŠ¤í”„ë§ í”„ë ˆì„ì›Œí¬ë¥¼ í¬í•¨í•˜ì—¬ ë§ì€ ê³³ì—ì„œ ì“°ì´ê³  ìˆìŒ`Javassist`: https://www.javassist.org/- ASM ë³´ë‹¤ëŠ” ì•„ë‹ˆì§€ë©´ ì—¬ì „íˆ ì‚¬ìš©í•˜ê¸°ê°€ ì–´ë µë‹¤ê³  í•œë‹¤.`ByteBuddy`: https://bytebuddy.net/#/- ë¹„êµì  ê°€ì¥ ìµœê·¼ì— ë‚˜ì˜¨ ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ë‹¤.- ìë°” ë°”ì´íŠ¸ ì½”ë“œì— ëŒ€í•´ì„œ ê¹Šê²Œ ëª°ë¼ë„ ì¶©ë¶„íˆ ì‚¬ìš© ê°€ëŠ¥í•˜ë©°, ëŸ¬ë‹ì»¤ë¸Œê°€ ë‚®ë‹¤.- ByteBuddyëŠ” ì‰½ê²Œ ì‚¬ìš© í•˜ëŠ”ê²ƒì„ ëª©ì ìœ¼ë¡œ ë§Œë“¤ì–´ì§„ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì´ë‹¤.- ByteBuddyëŠ” ByteBuddy APIë§Œ ì‚¬ìš©í• ì¤„ ì•ˆë‹¤ë©´ ì‰½ê²Œ ë°”ì´íŠ¸ì½”ë“œ ì¡°ì‘ì´ ê°€ëŠ¥í•˜ë‹¤.- ì½”ë“œë¥¼ ì‘ì„±í•˜ê¸°ëŠ” í¸í•˜ì§€ë§Œ, ì²´ì´ë‹ì´ ì‹¬í•´ì„œ ê°€ë…ì„±ì€ ì¢€ ë–¨ì–´ì§€ëŠ” í¸ <br/><br/>## âš¡ï¸ ByteBuddy ì‚¬ìš©í•˜ê¸°### ğŸ”‹ ByteBuddy gradle ì˜ì¡´ì„± ì¶”ê°€```groovydependencies {    //ByteBuddy - for bytecode manipulation    implementation 'net.bytebuddy:byte-buddy:1.14.0'}```### ğŸ”‹ íŒŒì¼ ë‚´ë¶€ì—ì„œ í˜¸ì¶œ ì „ì— ë³€ê²½í•˜ê¸°- ByteBuddy ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ í†µí•´ íŠ¹ì • í´ë˜ìŠ¤ì— ëŒ€í•´ ìƒˆë¡­ê²Œ ì •ì˜ëœ í´ë˜ìŠ¤ íŒŒì¼ì„ ë®ì–´ì”Œìš°ë©´, - ì´í›„ ì½”ë“œì—ì„œ ê°ì²´ë¥¼ ìƒì„±í•˜ê³  ë§¤ì†Œë“œë¥¼ í˜¸ì¶œí•  ë•Œ, ì›ë˜ ì½”ë“œì™€ëŠ” ì „í˜€ ë‹¤ë¥¸ ê°’ì´ ë°˜í™˜ë  ìˆ˜ ìˆë‹¤. ```javapublic class Magician {    public static void main(String[] args) {        //1. Hat.class ë‚´ì˜ pullOut ë§¤ì†Œë“œê°€ ê³ ì •ê°’ì¸ Rabbit!!! ì„ ë°˜í™˜í•˜ë„ë¡ ì¡°ì‘í•œ ìƒˆë¡œìš´ .class íŒŒì¼ë¡œ ë®ì–´ ì”Œìš°ê¸°        try {            new ByteBuddy()                .redefine(Hat.class)                .method(named("pullOut"))                .intercept(FixedValue.value("Rabbit!!!"))                .make()                .saveIn(new File("/Users/ihyeong-geol/Desktop/workspace/Writing-Down/java-code-manipulation/jacoco/build/classes/java/main/"));        } catch (IOException e) {            e.printStackTrace();        }        //2. ìœ„ì˜ ì½”ë“œ ì‹¤í–‰ í›„ ì£¼ì„ì²˜ë¦¬. ì•„ë˜ ì½”ë“œ ì‹¤í–‰ -> Rabbit!!! ì´ ë°˜í™˜ëœë‹¤.        System.out.println(new Hat().pullOut());       //return Rabbit!!!    }}```> ### **ë‘ ì½”ë“œë¥¼ ë™ì‹œì— ì‹¤í–‰í•  ìˆ˜ ì—†ëŠ” ì´ìœ ëŠ”?**> - 1ë²ˆ êµ¬ê°„ì˜ ì½”ë“œë¥¼ ì‹¤í–‰í•  ë•Œ, Hat.class ë¥¼ í•œë²ˆ ì½ì–´ë“¤ì¸ë‹¤. `ì½ëŠ” ì‹œì `ì—ëŠ” í•´ë‹¹ í´ë˜ìŠ¤ì˜ pullOut() ë§¤ì†Œë“œëŠ” ë°”ë€Œê¸° ì „ ê°’ì¸ "nothing" ê°’ì„ ê°€ì§€ê³  ìˆë‹¤. > - ì´ë¯¸ í´ë˜ìŠ¤ ë¡œë”ì—ì„œ Hat í´ë˜ìŠ¤ë¥¼ ì½ì–´ë“¤ì˜€ê¸° ë•Œë¬¸ì—, 1ë²ˆ êµ¬ê°„ ìˆ˜í–‰ í›„, Hat ì˜ í´ë˜ìŠ¤ íŒŒì¼ì´ ë³€ê²½ë˜ì—ˆë‹¤ê³  í•˜ë”ë¼ë„ 2ë²ˆ êµ¬ê°„ì„ ìˆ˜í–‰í•  ë•Œ, **ë‹¤ì‹œ ìƒˆë¡­ê²Œ í´ë˜ìŠ¤ íŒŒì¼ì„ ì½ì–´ë“¤ì´ì§€ ì•ŠëŠ”ë‹¤.** > - ê²°ê³¼ì ìœ¼ë¡œ 1ë²ˆ êµ¬ê°„ì—ì„œ ìµœì´ˆ ë¡œë“œ í›„ í´ë˜ìŠ¤ íŒŒì¼ì€ ë³€ê²½ë˜ì—ˆì§€ë§Œ (Rabbit ë°˜í™˜ì½”ë“œ) 2ë²ˆ êµ¬ê°„ì—ì„œëŠ” **ì´ë¯¸ ë¡œë”©ëœ í´ë˜ìŠ¤ ì •ë³´ (ë©”ì†Œë“œ ì˜ì—­ì— ìˆëŠ”)** ë¥¼ ë³´ê³  ìˆê¸° ë•Œë¬¸ì— ì´ì „ì— ì½ì–´ë“¤ì¸ Hat í´ë˜ìŠ¤ íŒŒì¼ (nothing ë°˜í™˜ì½”ë“œ) ì„ ì‹¤í–‰í•˜ê²Œ ë˜ëŠ” ê²ƒì´ë‹¤. <br/>### ğŸ”‹ í´ë˜ìŠ¤ íŒŒì¼ì„ ë¡œë“œí•˜ì§€ ì•Šê³  í´ë˜ìŠ¤ íŒŒì¼ì„ ë³€ê²½í•˜ê¸°```javapublic class Magician2 {    public static void main(String[] args) {        //1. í´ë˜ìŠ¤ íŒŒì¼ì„ ë¡œë“œí•˜ì§€ ì•Šê³  í´ë˜ìŠ¤ íŒŒì¼ì„ ë³€ê²½        ClassLoader classLoader = Magician2.class.getClassLoader();        TypePool typePool = TypePool.Default.of(classLoader);        try {            new ByteBuddy()                .redefine(typePool.describe("Hat").resolve(),                    ClassFileLocator.ForClassLoader.of(classLoader))                .method(named("pullOut"))                .intercept(FixedValue.value("Rabbit!!!"))                .make()                .saveIn(new File(                    "/Users/ihyeong-geol/Desktop/workspace/Writing-Down/java-code-manipulation/jacoco/build/classes/java/main/"));        } catch (IOException e) {            e.printStackTrace();        }        //2. ë³€ê²½ëœ í´ë˜ìŠ¤ íŒŒì¼ì„ ë¡œë“œ í›„ ì‹¤í–‰, Rabbit!!! ë°˜í™˜        System.out.println(new Hat().pullOut());       //Rabbit!!!    }}```- í’€íŒ¨í‚¤ì§€ ê²½ë¡œë¡œ ì¬ì •ì˜í•  Hat.class, classLoader ë¥¼ ì£¼ë©´, - 2ë²ˆì˜ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ê¸° ì „ ê¹Œì§€ëŠ” Hat í´ë˜ìŠ¤ë¥¼ ì½ì§€ ì•Šì•„ë„ ë˜ê¸° ë•Œë¬¸ì—, í´ë˜ìŠ¤ íŒŒì¼ì´ ë³€ê²½ëœë‹¤.í•˜ì§€ë§Œ, ìœ„ì˜ ì½”ë“œëŠ” ê²°êµ­ ì‹¤í–‰ ìˆœì„œì— ë”°ë¼ ê²°ê³¼ê°€ ë‹¬ë¼ì§€ë¯€ë¡œ, ì•„ì§ í•œê³„ì ì´ ìˆë‹¤. ë‹¤ë¥¸ ê³³ì—ì„œ Moja í´ë˜ìŠ¤ë¥¼ ë¨¼ì € ë¡œë“œí•´ì„œ ì½ì–´ë²„ë¦¬ëŠ” ê²½ìš°ì—ëŠ” ë¨¹íˆì§€ ì•ŠëŠ” ë°©ë²•ì´ë‹¤.ì™„ë²½í•˜ê²Œ ë°”ì´íŠ¸ ì½”ë“œë¥¼ ì¡°ì‘í•˜ë ¤ë©´, ê²°êµ­ ë‹¤ë¥¸ ê³³ì—ì„œ ë¨¼ì € ìœ„ì˜ ì¡°ì¹˜ë¥¼ ì·¨í•´ì£¼ì–´ì•¼ í•œë‹¤. ## âš¡ï¸javaagent ì‚¬ìš©í•˜ê¸°> javaagent ì‚¬ìš©í•˜ì—¬ ì–´í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰ì‹œì— ë°”ì´íŠ¸ ì½”ë“œ ì¡°ì‘í•˜ê¸°### ğŸ”‹ build.gradle```groovyjar {    manifest.attributes(            'Premain-Class' : 'MagicianAgent',            'Can-Redefine-Classes' : true,            'Can-Retransform-Classes' : true    )}dependencies {    //ByteBuddy - for bytecode manipulation    implementation 'net.bytebuddy:byte-buddy:1.14.0';    testImplementation 'org.junit.jupiter:junit-jupiter-api:5.8.1'    testRuntimeOnly 'org.junit.jupiter:junit-jupiter-engine:5.8.1'}```### ğŸ”‹ premain í•¨ìˆ˜ ì‘ì„±```javapublic class MagicianAgent {    public static void premain(String arguments, Instrumentation instrumentation) {        new AgentBuilder.Default()            .type(ElementMatchers.any())            .transform(                (builder, typeDescription, classLoader, module, protectionDomain)                    -> builder.method(named("pullOut")).intercept(FixedValue.value("Rabbit!"))            ).installOn(instrumentation);    }}```### ğŸ”‹ gradle ë¡œ jar íŒŒì¼ ìƒì„±<img width="437" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-07-09 á„‹á…©á„’á…® 4 59 49" src="https://github.com/LeeHyungGeol/Algorithm_BaekJoon/assets/56071088/b812fede-5a7b-4508-a739-585a82626d3c"><img width="367" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-07-09 á„‹á…©á„’á…® 5 00 37" src="https://github.com/LeeHyungGeol/Algorithm_BaekJoon/assets/56071088/b6e4ec50-f770-4531-bdb9-6c5e7fa1d5f5">### ğŸ”‹ bytebuddy ì½”ë“œë¥¼ ì œê±°í•œ ì•„ë¬´ê²ƒë„ ì—†ëŠ” ì½”ë“œ ìƒì„±```javapackage agent;public class Magician3 {    public static void main(String[] args) {        System.out.println(new Hat3().pullOut());       //Rabbit!!!    }}package agent;public class Hat3 {  public String pullOut() {    return "nothing";  }}```### ğŸ”‹ VM Options ì¶”ê°€<img width="800" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-07-09 á„‹á…©á„’á…® 4 57 14" src="https://github.com/LeeHyungGeol/Algorithm_BaekJoon/assets/56071088/1c0ce2cc-8428-4e65-99bd-2333e24bfde9">`-javaagent:/Users/.../masulsa-agent/build/libs/masulsa-agent-1.0-SNAPSHOT.jar`### ğŸ”‹ ì‹¤í–‰ ê²°ê³¼<img width="364" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-07-09 á„‹á…©á„’á…® 5 06 13" src="https://github.com/LeeHyungGeol/Algorithm_BaekJoon/assets/56071088/b29bf0b5-bcfd-480f-93e0-8ba435e7d2a5"><img width="469" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-07-09 á„‹á…©á„’á…® 5 07 04" src="https://github.com/LeeHyungGeol/Algorithm_BaekJoon/assets/56071088/702e1e29-b613-49e2-8cfd-2594db502be7">- **ì›ë˜ ì½”ë“œì˜ ë°”ì´íŠ¸ ì½”ë“œëŠ” ì „í˜€ ë°”ê¾¸ì§€ ì•Šê³ ë„, `javaagent` ì— ì˜í•´ì„œ Rabbit ìœ¼ë¡œ ë°”ë€ ì½”ë“œê°€ ì¶œë ¥ëœë‹¤.**<br/><br/>## âš¡ï¸ ì •ë¦¬ì´ 3ê°€ì§€ ë°©ë²•ì„ í†µí•´ì„œ java class íŒŒì¼ì„ ì¡°ì‘í•´ë³´ì•˜ë‹¤.1. í´ë˜ìŠ¤ íŒŒì¼ì„ ì½ê³  ë³€ê²½í•œ ë’¤, ì¬í˜¸ì¶œì‹œì—ëŠ” ë‹¤ì‹œ í´ë˜ìŠ¤íŒŒì¼ì„ ë¡œë“œí•˜ì§€ ì•Šê³ , ë³€ê²½ëœ í´ë˜ìŠ¤ íŒŒì¼ì„ ì‚¬ìš©í•˜ë„ë¡ í•˜ëŠ” ë°©ì‹  -> ë³€ê²½ëœ í´ë˜ìŠ¤ íŒŒì¼ì„ ì‚¬ìš©í•œë‹¤.2. í´ë˜ìŠ¤ ë¡œë“œ ì „, ë©”ëª¨ë¦¬ì— ìˆëŠ” ë°”ì´íŠ¸ ì½”ë“œ íŒŒì¼ì„ ì§ì ‘ ê±´ë“œë ¤ í´ë˜ìŠ¤ ë¡œë“œ ì‹œì—ëŠ” ì²˜ìŒë¶€í„° ë°”ë€ íŒŒì¼ì´ ì½íˆë„ë¡ í•˜ëŠ” ë°©ì‹  -> í´ë˜ìŠ¤ íŒŒì¼ì´ ë³€ê²½ëœë‹¤.3. ì™¸ë¶€ì—ì„œ javaagent jar íŒŒì¼ ë‚´ premain() ë§¤ì†Œë“œë¥¼ í†µí•´ì„œ í´ë˜ìŠ¤ ë¡œë“œ ì‹œì— ë°”ì´íŠ¸ ì½”ë“œ íŒŒì¼ (í´ë˜ìŠ¤íŒŒì¼)ì„ ë³€ê²½í•˜ëŠ” ë°©ë²• -> í´ë˜ìŠ¤ íŒŒì¼ì´ ë³€ê²½ë˜ì§€ ì•Šê³  ë°”ê¿”ì¹˜ê¸°í•œ íŒŒì¼ì´ ì‚¬ìš©ëœë‹¤.   - í´ë˜ìŠ¤ ë¡œë”ê°€ í´ë˜ìŠ¤ë¥¼ ì½ì–´ì˜¬ ë•Œ, javaagent ë¥¼ ê±°ì³ì„œ ë³€ê²½ëœ ë°”ì´íŠ¸ì½”ë“œë¥¼ ì½ì–´ë“¤ì—¬ ì‚¬ìš©í•œë‹¤. ë”°ë¼ì„œ ì‹¤ì œ ë°”ì´íŠ¸ ì½”ë“œëŠ” ë³€ê²½ì´ ì—†ë‹¤.**ì²˜ìŒ ë‘ ë°©ë²•ì€ ì½”ë“œì˜ ì‹¤í–‰ ìˆœì„œì— ë”°ë¼ì„œ ê²°ê³¼ê°€ ë‹¬ë¼ì§€ë¯€ë¡œ, 3ë²ˆ ë°©ë²•ì´ ê°€ì¥ ì •í™•í•˜ê³  transparent(ê¸°ì¡´ ì½”ë“œë¥¼ ë³€ê²½í•˜ì§€ ì•ŠëŠ” ê¹¨ë—í•œ) í•œ ë°©ë²•ì´ë¼ê³  í•  ìˆ˜ ìˆê² ë‹¤.****ì‹œì¤‘ì— ë°”ì´íŠ¸ ì½”ë“œë¥¼ ì¡°ì‘í•˜ì—¬ ë§Œë“  íˆ´ë“¤ì€ ê²°êµ­ ì´ì²˜ëŸ¼ ê¸°ì¡´ ì†ŒìŠ¤ì½”ë“œë¥¼ ê±´ë“œë¦¬ì§€ ì•ŠëŠ” ë°©ë²•ì„ ì‚¬ìš©í•˜ì—¬ êµ¬í˜„ëœ í˜•íƒœì¼ ê²ƒì´ë‹¤.** <br/><br/><br/># ğŸ’¡ Spring ì€ asm ì„ ì´ìš©í•˜ì—¬ ì»´í¬ë„ŒíŠ¸ ìŠ¤ìº”ì„ í•œë‹¤SpringApplication ì˜ ì‹œì‘ì ì— ë¶™ì€ @SpringBootApplication ë‚´ë¶€ë¥¼ ì‚´í´ë³´ë©´, @ComponantScan ì´ë¼ê³  í•˜ëŠ” ì–´ë…¸í…Œì´ì…˜ì´ ìˆë‹¤.í•´ë‹¹ ì–´ë…¸í…Œì´ì…˜ì€ í•´ë‹¹ ìœ„ì¹˜ë¶€í„° ëª¨ë“  í•˜ìœ„ ë””ë ‰í† ë¦¬ë¥¼ ëŒë©´ì„œ `@Component`, `@Bean` ì–´ë…¸í…Œì´ì…˜ì´ ë¶™ì€ ëª¨ë“  í´ë˜ìŠ¤ë“¤ì„ ìŠ¤ìº”í•˜ì—¬ ë¹ˆìœ¼ë¡œ ë“±ë¡í•´ì¤€ë‹¤.```java@SpringBootApplicationpublic class ExampleApplication {    public static void main(String[] args) {        SpringApplication.run(ExampleApplication.class, args);    }}@ComponentScan(excludeFilters = { @Filter(type = FilterType.CUSTOM, classes = TypeExcludeFilter.class),@Filter(type = FilterType.CUSTOM, classes = AutoConfigurationExcludeFilter.class) })public @interface SpringBootApplication {...}```ì´ì²˜ëŸ¼ ì»´í¬ë„ŒíŠ¸ë¥¼ ìŠ¤ìº”í•˜ëŠ” ê³¼ì •ì—ì„œ ì‚¬ìš©ë˜ëŠ” ê²ƒì´ ë°”ë¡œ `ClassPathScanningCandidateComponentProvider`, `SimpleMetadataReader` ì´ë‹¤.<br/>### ğŸ”‹ ClassPathScanningCandidateComponentProviderì‹¤ì œë¡œ ì½”ë“œì˜ docs ë¥¼ ë³´ë©´,  ASM ClassReader ë¥¼ ì´ìš©í•˜ê³  ìˆë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.<img width="879" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-07-09 á„‹á…©á„’á…® 5 26 32" src="https://github.com/LeeHyungGeol/Algorithm_BaekJoon/assets/56071088/69293f13-1273-4a24-816e-44a6767f78e1">```java	private Set<BeanDefinition> addCandidateComponentsFromIndex(CandidateComponentsIndex index, String basePackage) {    ...    for (String type : types) {        MetadataReader metadataReader = getMetadataReaderFactory().getMetadataReader(type);        ...}```type ìœ¼ë¡œë¶€í„° ë©”íƒ€ë°ì´í„°ë¥¼ ì½ì–´ì˜¨ë‹¤. ë©”íƒ€ë°ì´í„°ë¥¼ ì½ëŠ” readerê°€ ë°”ë¡œ SimpleMetadataReader<br/>### ğŸ”‹ SimpleMetadataReaderclassReader, AnnotaionMetadataReadingVisitor ë¥¼ ì´ìš©í•˜ì—¬ í´ë˜ìŠ¤, ë©”ì„œë“œì— ë¶™ì–´ìˆëŠ” ì–´ë…¸í…Œì´ì…˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¨ë‹¤.```javaSimpleMetadataReader(Resource resource, @Nullable ClassLoader classLoader) throws IOException {		SimpleAnnotationMetadataReadingVisitor visitor = new SimpleAnnotationMetadataReadingVisitor(classLoader);		getClassReader(resource).accept(visitor, PARSING_OPTIONS);		this.resource = resource;		this.annotationMetadata = visitor.getMetadata();}```<br/>### ğŸ”‹ ClassReaderasm ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ìŠ¤í”„ë§ì—ì„œ ì•„ì˜ˆ íŒ¨í‚¤ì§€ ë‚´ë¶€ë¡œ í¬í•¨ì‹œí‚´<img width="727" alt="á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2024-07-09 á„‹á…©á„’á…® 5 33 30" src="https://github.com/LeeHyungGeol/Algorithm_BaekJoon/assets/56071088/86b5d57c-7328-44d1-a042-fbf1a8818a48"><br/><br/><br/>## ì°¸ê³ - https://wiki.mhson.world/java-spring/java/undefined-1-1- https://www.youtube.com/watch?v=39kdr1mNZ_s- ASM, ByteBuddy, CGlib, PinPoint